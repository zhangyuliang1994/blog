---
title: 4.17 ç½‘ç«™æ•°æ®åˆ†æå·¥å…·
description: ç½‘ç«™æ•°æ®åˆ†æå·¥å…·é›†æˆæŒ‡å—ï¼ŒåŒ…å«Google Analyticsã€Microsoft Clarityé…ç½®
order: 43
---

# 4.17 ğŸ“Š ç½‘ç«™æ•°æ®åˆ†æå·¥å…·

# ç½‘ç«™æ•°æ®åˆ†æå·¥å…·é›†æˆæŒ‡å—

æœ¬æ•™ç¨‹å°†æŒ‡å¯¼ä½ å¦‚ä½•åœ¨Next.jsé¡¹ç›®ä¸­é›†æˆGoogle Analyticså’ŒMicrosoft Clarityç­‰æ•°æ®åˆ†æå·¥å…·ï¼Œå¸®åŠ©ä½ è¿½è¸ªå’Œåˆ†æç”¨æˆ·è¡Œä¸ºã€‚

<video controls width="100%" style={{maxWidth: '800px'}}>
  <source src="https://minio.xiaofeng.show/ai-code/4.17.mp4" type="video/mp4" />
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚
</video>

---

### **ç½‘ç«™æ•°æ®åˆ†æå·¥å…·é›†æˆå®Œå…¨æŒ‡å—**

**ç›®æ ‡**ï¼šå­¦ä¹ å¦‚ä½•åœ¨Next.jsé¡¹ç›®ä¸­è®¾ç½®å’Œä½¿ç”¨Google Analyticså’ŒMicrosoft Clarityè¿›è¡Œç”¨æˆ·è¡Œä¸ºåˆ†æã€‚

---

### **ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç«™åˆ†æå·¥å…·ï¼Ÿ**

- **äº†è§£ç”¨æˆ·è¡Œä¸º**ï¼šåˆ†æç”¨æˆ·å¦‚ä½•ä¸ä½ çš„ç½‘ç«™äº’åŠ¨
- **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**ï¼šå‘ç°å¹¶è§£å†³ç”¨æˆ·ä½“éªŒé—®é¢˜
- **æ•°æ®é©±åŠ¨å†³ç­–**ï¼šåŸºäºå®é™…æ•°æ®è€ŒéçŒœæµ‹åšå‡ºå†³ç­–
- **è¡¡é‡è¥é”€æ•ˆæœ**ï¼šè¯„ä¼°ä¸åŒè¥é”€æ¸ é“å’Œæ´»åŠ¨çš„æ•ˆæœ
- **æé«˜è½¬åŒ–ç‡**ï¼šè¯†åˆ«å¹¶ä¼˜åŒ–è½¬åŒ–æ¼æ–—ä¸­çš„é—®é¢˜ç‚¹

---

### **äºŒã€Google Analytics ç®€ä»‹**

1. **ä»€ä¹ˆæ˜¯Google Analyticsï¼Ÿ**
    - Googleæä¾›çš„å…è´¹ç½‘ç«™åˆ†ææœåŠ¡
    - æä¾›å…¨é¢çš„ç½‘ç«™æµé‡å’Œç”¨æˆ·è¡Œä¸ºæ•°æ®
    - æ”¯æŒç›®æ ‡è½¬åŒ–è·Ÿè¸ªã€äº‹ä»¶è·Ÿè¸ªç­‰é«˜çº§åŠŸèƒ½
2. **Google Analytics 4 (GA4)çš„ä¸»è¦ç‰¹ç‚¹**ï¼š
    - åŸºäºäº‹ä»¶çš„æ•°æ®æ¨¡å‹
    - è·¨å¹³å°è·Ÿè¸ªèƒ½åŠ›ï¼ˆç½‘ç«™å’Œåº”ç”¨ï¼‰
    - å†…ç½®æœºå™¨å­¦ä¹ åŠŸèƒ½
    - æ›´å¼ºå¤§çš„éšç§æ§åˆ¶
    - æ›´å¥½çš„ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸåˆ†æ

---

### **ä¸‰ã€Microsoft Clarity ç®€ä»‹**

1. **ä»€ä¹ˆæ˜¯Microsoft Clarityï¼Ÿ**
    - å¾®è½¯æä¾›çš„å…è´¹ç”¨æˆ·è¡Œä¸ºåˆ†æå·¥å…·
    - æä¾›çƒ­å›¾ã€ä¼šè¯å½•åˆ¶ã€ç‚¹å‡»è·Ÿè¸ªç­‰åŠŸèƒ½
    - å¸®åŠ©ç›´è§‚ç†è§£ç”¨æˆ·å¦‚ä½•ä¸ç½‘ç«™äº’åŠ¨
2. **Microsoft Clarityçš„ä¸»è¦åŠŸèƒ½**ï¼š
    - **çƒ­å›¾**ï¼šç›´è§‚æ˜¾ç¤ºç”¨æˆ·ç‚¹å‡»ã€æ»šåŠ¨å’Œæ³¨æ„åŠ›åˆ†å¸ƒ
    - **ä¼šè¯å½•åˆ¶**ï¼šå›æ”¾ç”¨æˆ·æµè§ˆç½‘ç«™çš„è¿‡ç¨‹
    - **æ´å¯Ÿé¢æ¿**ï¼šè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·ä½“éªŒé—®é¢˜
    - **ä¸Google Analyticsé›†æˆ**ï¼šç»“åˆä¸¤è€…æ•°æ®è·å¾—æ›´å…¨é¢åˆ†æ

---

### **å››ã€åˆ›å»ºGoogle Analyticsè´¦æˆ·å’Œå±æ€§**

### **1. æ³¨å†ŒGoogle Analytics**

1. è®¿é—®[Google Analyticså®˜ç½‘](https://analytics.google.com/)
2. ä½¿ç”¨Googleè´¦å·ç™»å½•
3. ç‚¹å‡»"å¼€å§‹è¡¡é‡"æŒ‰é’®

### **2. è®¾ç½®æ•°æ®æµ**

1. åˆ›å»ºè´¦å·ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
    - è¾“å…¥è´¦å·åç§°ï¼ˆé€šå¸¸æ˜¯å…¬å¸æˆ–ç»„ç»‡åç§°ï¼‰
    - é€‰æ‹©æ•°æ®å…±äº«è®¾ç½®
    - ç‚¹å‡»"ä¸‹ä¸€æ­¥"
2. åˆ›å»ºåª’ä½“èµ„æº
    - è¾“å…¥åª’ä½“èµ„æºåç§°ï¼ˆé€šå¸¸æ˜¯ç½‘ç«™åç§°ï¼‰
    - è®¾ç½®æŠ¥å‘Šæ—¶åŒºå’Œè´§å¸
    - ç‚¹å‡»"ä¸‹ä¸€æ­¥"
3. æä¾›ä¸šåŠ¡ä¿¡æ¯
    - é€‰æ‹©è¡Œä¸šç±»åˆ«
    - é€‰æ‹©ä¸šåŠ¡è§„æ¨¡
    - é€‰æ‹©ä½¿ç”¨ç›®çš„
    - ç‚¹å‡»"åˆ›å»º"
4. åˆ›å»ºæ•°æ®æµ
    - é€‰æ‹©å¹³å°ï¼ˆWebï¼‰
    - è¾“å…¥ç½‘ç«™URL
    - è¾“å…¥æ•°æ®æµåç§°
    - ç‚¹å‡»"åˆ›å»ºæ•°æ®æµ"

### **3. è·å–è·Ÿè¸ªID**

1. åˆ›å»ºæ•°æ®æµåï¼Œä½ å°†è·å¾—ä¸€ä¸ªè¡¡é‡IDï¼ˆæ ¼å¼ä¸ºG-XXXXXXXXï¼‰
2. è®°å½•æ­¤IDï¼Œç¨åå°†ç”¨äºNext.jsé›†æˆ

---

### **äº”ã€åˆ›å»ºMicrosoft Clarityé¡¹ç›®**

### **1. æ³¨å†ŒMicrosoft Clarity**

1. è®¿é—®[Microsoft Clarityå®˜ç½‘](https://clarity.microsoft.com/)
2. ä½¿ç”¨Microsoftè´¦å·ç™»å½•
3. ç‚¹å‡»"åˆ›å»ºæ–°é¡¹ç›®"æŒ‰é’®

![](https://s.web.cafe/aimaker/images/getting-started/analytics/analytics-1.webp)

### **2. è®¾ç½®é¡¹ç›®**

1. è¾“å…¥é¡¹ç›®åç§°
2. è¾“å…¥ç½‘ç«™URL
3. é€‰æ‹©è¡Œä¸šï¼ˆå¯é€‰ï¼‰
4. ç‚¹å‡»"åˆ›å»ºé¡¹ç›®"

### **3. è·å–è·Ÿè¸ªä»£ç **

1. åˆ›å»ºé¡¹ç›®åï¼Œä½ å°†çœ‹åˆ°ä¸€æ®µJavaScriptä»£ç 

![](https://s.web.cafe/aimaker/images/getting-started/analytics/analytics-2.webp)

1. æ­¤ä»£ç åŒ…å«ä½ çš„é¡¹ç›®ID
2. è®°å½•æ­¤ä»£ç æˆ–é¡¹ç›®IDï¼Œç¨åå°†ç”¨äºNext.jsé›†æˆ

![](https://s.web.cafe/aimaker/images/getting-started/analytics/analytics-3.webp)

1. ç»‘å®šGA

![](https://s.web.cafe/aimaker/images/getting-started/analytics/analytics-4.webp)

---

### **å…­ã€åœ¨Next.jsä¸­é›†æˆGoogle Analytics**

### **1. ä½¿ç”¨App Router (æ¨è)**

1. **åˆ›å»ºGoogle Analyticsç»„ä»¶**

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ç»„ä»¶æ¥åŠ è½½Google Analyticsè„šæœ¬ï¼š

```
// app/components/GoogleAnalytics.tsx 'use client'; 
import { useEffect } from 'react'; import Script from 'next/script'; 
export default function GoogleAnalytics({ GA_MEASUREMENT_ID }: { GA_MEASUREMENT_ID: string }) {  return (  <>  <Script  strategy="afterInteractive"  src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}  />  <Script  id="google-analytics"  strategy="afterInteractive"  dangerouslySetInnerHTML={{  __html: `  window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '${GA_MEASUREMENT_ID}', {
 page_path: window.location.pathname, }); `,  }}  />  </>  ); }
```

1. **åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨è¯¥ç»„ä»¶**

å°†Google Analyticsç»„ä»¶æ·»åŠ åˆ°æ ¹å¸ƒå±€æ–‡ä»¶ä¸­ï¼š

```
// app/layout.tsx import GoogleAnalytics from './components/GoogleAnalytics'; 
export default function RootLayout({  children, }: {  children: React.ReactNode; }) {  // ä»ç¯å¢ƒå˜é‡è·å–GA ID  const GA_MEASUREMENT_ID = process.env.NEXT_PUBLIC_GA_ID || '';   
 return (  <html lang="zh">  <head />  <body>  {GA_MEASUREMENT_ID && <GoogleAnalytics GA_MEASUREMENT_ID={GA_MEASUREMENT_ID} />}  {children}  </body>  </html>  ); }
```

1. **è®¾ç½®ç¯å¢ƒå˜é‡**

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`.env.local`æ–‡ä»¶ï¼š

`NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX`

å°†`G-XXXXXXXXXX`æ›¿æ¢ä¸ºä½ çš„Google Analyticsè¡¡é‡IDã€‚

### **2. ä½¿ç”¨Pages Router**

å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆPages Routerï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é›†æˆï¼š

1. **åˆ›å»ºGoogle Analyticsç»„ä»¶**

```
// components/GoogleAnalytics.tsx import Script from 'next/script'; 
const GoogleAnalytics = ({ GA_MEASUREMENT_ID }: { GA_MEASUREMENT_ID: string }) => {  return (  <>  <Script  strategy="afterInteractive"  src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}  />  <Script  id="google-analytics"  strategy="afterInteractive"  dangerouslySetInnerHTML={{  __html: `  window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '${GA_MEASUREMENT_ID}', {
 page_path: window.location.pathname, }); `,  }}  />  </>  ); }; 
export default GoogleAnalytics;
```

1. **åœ¨_app.tsxä¸­ä½¿ç”¨è¯¥ç»„ä»¶**

```
// pages/_app.tsx import type { AppProps } from 'next/app'; import GoogleAnalytics from '../components/GoogleAnalytics'; 
function MyApp({ Component, pageProps }: AppProps) {  const GA_MEASUREMENT_ID = process.env.NEXT_PUBLIC_GA_ID || '';   
 return (  <>  {GA_MEASUREMENT_ID && <GoogleAnalytics GA_MEASUREMENT_ID={GA_MEASUREMENT_ID} />}  <Component {...pageProps} />  </>  ); } 
export default MyApp;
```

### **3. è·Ÿè¸ªé¡µé¢æµè§ˆ**

åœ¨App Routerä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹Next.jsä¸ä¼šåœ¨å®¢æˆ·ç«¯å¯¼èˆªæ—¶è‡ªåŠ¨æ›´æ–°Google Analyticsã€‚æˆ‘ä»¬éœ€è¦æ·»åŠ è‡ªå®šä¹‰é€»è¾‘æ¥è·Ÿè¸ªé¡µé¢æµè§ˆï¼š

```
// app/components/GoogleAnalytics.tsx 'use client'; 
import { useEffect } from 'react'; import { usePathname, useSearchParams } from 'next/navigation'; import Script from 'next/script'; 
export default function GoogleAnalytics({ GA_MEASUREMENT_ID }: { GA_MEASUREMENT_ID: string }) {  const pathname = usePathname();  const searchParams = useSearchParams(); 
 useEffect(() => {  if (pathname && window.gtag) {  window.gtag('config', GA_MEASUREMENT_ID, {  page_path: pathname + searchParams.toString(),  });  }  }, [pathname, searchParams, GA_MEASUREMENT_ID]); 
 return (  <>  <Script  strategy="afterInteractive"  src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}  />  <Script id="google-analytics" strategy="afterInteractive" dangerouslySetInnerHTML={{  __html: `  window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '${GA_MEASUREMENT_ID}', {
 page_path: '${pathname}${searchParams.toString()}',
 }); `,  }}  /> </>  ); }
```

### **4. æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶è·Ÿè¸ª**

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå·¥å…·å‡½æ•°æ¥è·Ÿè¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼š

```
// lib/gtag.ts type GTagEvent = {  action: string;  category: string;  label: string;  value?: number; }; 
// å£°æ˜å…¨å±€gtagå‡½æ•° declare global {  interface Window {  gtag: (  command: 'event',  action: string,  params: { [key: string]: any }  ) => void;  } } 
// å‘é€äº‹ä»¶åˆ°Google Analytics export const event = ({ action, category, label, value }: GTagEvent) => {  window.gtag('event', action, {  event_category: category,  event_label: label,  value: value,  }); };
```

ä½¿ç”¨ç¤ºä¾‹ï¼š

```
import { event } from '../lib/gtag'; 
// åœ¨æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸­ const handleClick = () => {  event({  action: 'click',  category: 'button',  label: 'sign_up',  });   
 // å…¶ä»–é€»è¾‘... };
```

---

### **ä¸ƒã€åœ¨Next.jsä¸­é›†æˆMicrosoft Clarity**

### **1. ä½¿ç”¨App Router (æ¨è)**

1. **åˆ›å»ºMicrosoft Clarityç»„ä»¶**

```
// app/components/MicrosoftClarity.tsx 'use client'; 
import { useEffect } from 'react'; import Script from 'next/script'; 
export default function MicrosoftClarity({ CLARITY_PROJECT_ID }: { CLARITY_PROJECT_ID: string }) {  return (  <Script  id="microsoft-clarity"  strategy="afterInteractive"  dangerouslySetInnerHTML={{  __html: `  (function(c,l,a,r,i,t,y){ c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i; y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y); })(window, document, "clarity", "script", "${CLARITY_PROJECT_ID}");
 `,  }}  />  ); }
```

1. **åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨è¯¥ç»„ä»¶**

```
// app/layout.tsx import GoogleAnalytics from './components/GoogleAnalytics'; import MicrosoftClarity from './components/MicrosoftClarity'; 
export default function RootLayout({  children, }: {  children: React.ReactNode; }) {  const GA_MEASUREMENT_ID = process.env.NEXT_PUBLIC_GA_ID || '';  const CLARITY_PROJECT_ID = process.env.NEXT_PUBLIC_CLARITY_ID || '';   
 return (  <html lang="zh">  <head />  <body>  {GA_MEASUREMENT_ID && <GoogleAnalytics GA_MEASUREMENT_ID={GA_MEASUREMENT_ID} />}  {CLARITY_PROJECT_ID && <MicrosoftClarity CLARITY_PROJECT_ID={CLARITY_PROJECT_ID} />}  {children}  </body>  </html>  ); }
```

1. **è®¾ç½®ç¯å¢ƒå˜é‡**

åœ¨`.env.local`æ–‡ä»¶ä¸­æ·»åŠ Clarityé¡¹ç›®IDï¼š

`NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX NEXT_PUBLIC_CLARITY_ID=XXXXXXXXXX`

å°†`XXXXXXXXXX`æ›¿æ¢ä¸ºä½ çš„Microsoft Clarityé¡¹ç›®IDã€‚

### **2. ä½¿ç”¨Pages Router**

å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆPages Routerï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é›†æˆï¼š

1. **åˆ›å»ºMicrosoft Clarityç»„ä»¶**

```
// components/MicrosoftClarity.tsx import Script from 'next/script'; 
const MicrosoftClarity = ({ CLARITY_PROJECT_ID }: { CLARITY_PROJECT_ID: string }) => {  return (  <Script  id="microsoft-clarity"  strategy="afterInteractive"  dangerouslySetInnerHTML={{  __html: `  (function(c,l,a,r,i,t,y){ c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i; y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y); })(window, document, "clarity", "script", "${CLARITY_PROJECT_ID}");
 `,  }}  />  ); }; 
export default MicrosoftClarity;
```

1. **åœ¨_app.tsxä¸­ä½¿ç”¨è¯¥ç»„ä»¶**

```
// pages/_app.tsx import type { AppProps } from 'next/app'; import GoogleAnalytics from '../components/GoogleAnalytics'; import MicrosoftClarity from '../components/MicrosoftClarity'; 
function MyApp({ Component, pageProps }: AppProps) {  const GA_MEASUREMENT_ID = process.env.NEXT_PUBLIC_GA_ID || '';  const CLARITY_PROJECT_ID = process.env.NEXT_PUBLIC_CLARITY_ID || '';   
 return (  <>  {GA_MEASUREMENT_ID && <GoogleAnalytics GA_MEASUREMENT_ID={GA_MEASUREMENT_ID} />}  {CLARITY_PROJECT_ID && <MicrosoftClarity CLARITY_PROJECT_ID={CLARITY_PROJECT_ID} />}  <Component {...pageProps} />  </>  ); } 
export default MyApp;
```

---

### **å…«ã€åˆ›å»ºç»Ÿä¸€çš„åˆ†æå·¥å…·ç»„ä»¶**

ä¸ºäº†æ›´å¥½åœ°ç®¡ç†å¤šä¸ªåˆ†æå·¥å…·ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„ç»„ä»¶ï¼š

```
// app/components/Analytics.tsx 'use client'; 
import Script from 'next/script'; import { usePathname, useSearchParams } from 'next/navigation'; import { useEffect } from 'react'; 
interface AnalyticsProps {  GA_MEASUREMENT_ID?: string;  CLARITY_PROJECT_ID?: string; } 
export default function Analytics({  GA_MEASUREMENT_ID,  CLARITY_PROJECT_ID }: AnalyticsProps) {  const pathname = usePathname();  const searchParams = useSearchParams(); 
 // è·Ÿè¸ªé¡µé¢æµè§ˆ  useEffect(() => {  if (pathname && window.gtag) {  window.gtag('config', GA_MEASUREMENT_ID!, {  page_path: pathname + searchParams.toString(),  });  }  }, [pathname, searchParams, GA_MEASUREMENT_ID]); 
 return (  <>  {/* Google Analytics */}  {GA_MEASUREMENT_ID && (  <>  <Script  strategy="afterInteractive"  src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}  />  <Script id="google-analytics" strategy="afterInteractive" dangerouslySetInnerHTML={{  __html: `  window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '${GA_MEASUREMENT_ID}', {
 page_path: '${pathname}${searchParams.toString()}',
 }); `,  }}  /> </>  )}   {/* Microsoft Clarity */}  {CLARITY_PROJECT_ID && (  <Script  id="microsoft-clarity"  strategy="afterInteractive"  dangerouslySetInnerHTML={{  __html: `  (function(c,l,a,r,i,t,y){ c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i; y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y); })(window, document, "clarity", "script", "${CLARITY_PROJECT_ID}");
 `,  }}  />  )}  </>  ); }
```

ç„¶ååœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨ï¼š

```
// app/layout.tsx import Analytics from './components/Analytics'; 
export default function RootLayout({  children, }: {  children: React.ReactNode; }) {  const GA_MEASUREMENT_ID = process.env.NEXT_PUBLIC_GA_ID || '';  const CLARITY_PROJECT_ID = process.env.NEXT_PUBLIC_CLARITY_ID || '';   
 return (  <html lang="zh">  <head />  <body>  <Analytics  GA_MEASUREMENT_ID={GA_MEASUREMENT_ID}  CLARITY_PROJECT_ID={CLARITY_PROJECT_ID}  />  {children}  </body>  </html>  ); }
```

---

### **ä¹ã€éšç§åˆè§„ä¸GDPRè€ƒè™‘**

### **1. éšç§æ”¿ç­–æ›´æ–°**

1. ç¡®ä¿ä½ çš„ç½‘ç«™æœ‰éšç§æ”¿ç­–é¡µé¢
2. åœ¨éšç§æ”¿ç­–ä¸­æ˜ç¡®è¯´æ˜ä½ ä½¿ç”¨çš„åˆ†æå·¥å…·
3. è§£é‡Šæ”¶é›†çš„æ•°æ®ç±»å‹å’Œç”¨é€”

### **2. CookieåŒæ„æ¨ªå¹…**

1. æ·»åŠ CookieåŒæ„æ¨ªå¹…ï¼Œè®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦æ¥å—åˆ†æCookie
2. åªæœ‰åœ¨ç”¨æˆ·åŒæ„åæ‰åŠ è½½åˆ†æè„šæœ¬

ç¤ºä¾‹CookieåŒæ„ç»„ä»¶ï¼š

```
// app/components/CookieConsent.tsx 'use client'; 
import { useState, useEffect } from 'react'; import { setCookie, getCookie } from 'cookies-next'; 
export default function CookieConsent() {  const [showConsent, setShowConsent] = useState(false); 
 useEffect(() => {  // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»åšå‡ºé€‰æ‹©  const consentGiven = getCookie('cookie-consent');  if (consentGiven === undefined) {  setShowConsent(true);  }  }, []); 
 const acceptCookies = () => {  setCookie('cookie-consent', 'true', { maxAge: 60 * 60 * 24 * 365 });  setShowConsent(false);  window.location.reload(); // é‡æ–°åŠ è½½é¡µé¢ä»¥æ¿€æ´»åˆ†æè„šæœ¬  }; 
 const declineCookies = () => {  setCookie('cookie-consent', 'false', { maxAge: 60 * 60 * 24 * 365 });  setShowConsent(false);  }; 
 if (!showConsent) return null; 
 return (  <div className="fixed bottom-0 left-0 right-0 bg-gray-100 p-4 shadow-md z-50">  <div className="container mx-auto flex flex-col md:flex-row items-center justify-between">  <p className="mb-4 md:mb-0">  æˆ‘ä»¬ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒå¹¶åˆ†æç½‘ç«™æµé‡ã€‚ <a href="/privacy-policy" className="underline ml-1">  äº†è§£æ›´å¤š </a>  </p>  <div className="flex space-x-4">  <button  onClick={declineCookies}  className="px-4 py-2 border border-gray-300 rounded"  >  æ‹’ç» </button>  <button  onClick={acceptCookies}  className="px-4 py-2 bg-blue-500 text-white rounded"  >  æ¥å— </button>  </div>  </div>  </div>  ); }
```

1. **æœ‰æ¡ä»¶åŠ è½½åˆ†æè„šæœ¬**

ä¿®æ”¹Analyticsç»„ä»¶ï¼Œåªåœ¨ç”¨æˆ·åŒæ„ååŠ è½½ï¼š

```
// app/components/Analytics.tsx 'use client'; 
import Script from 'next/script'; import { usePathname, useSearchParams } from 'next/navigation'; import { useEffect, useState } from 'react'; import { getCookie } from 'cookies-next'; 
interface AnalyticsProps {  GA_MEASUREMENT_ID?: string;  CLARITY_PROJECT_ID?: string; } 
export default function Analytics({  GA_MEASUREMENT_ID,  CLARITY_PROJECT_ID }: AnalyticsProps) {  const pathname = usePathname();  const searchParams = useSearchParams();  const [cookieConsent, setCookieConsent] = useState<boolean | null>(null); 
 useEffect(() => {  const consent = getCookie('cookie-consent');  setCookieConsent(consent === 'true');  }, []); 
 // è·Ÿè¸ªé¡µé¢æµè§ˆ  useEffect(() => {  if (pathname && window.gtag && cookieConsent) {  window.gtag('config', GA_MEASUREMENT_ID!, {  page_path: pathname + searchParams.toString(),  });  }  }, [pathname, searchParams, GA_MEASUREMENT_ID, cookieConsent]); 
 // å¦‚æœç”¨æˆ·æœªåŒæ„ï¼Œä¸åŠ è½½åˆ†æè„šæœ¬  if (!cookieConsent) return null; 
 return (  <>  {/* Google Analytics */}  {GA_MEASUREMENT_ID && (  <>  <Script  strategy="afterInteractive"  src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}  />  <Script id="google-analytics" strategy="afterInteractive" dangerouslySetInnerHTML={{  __html: `  window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '${GA_MEASUREMENT_ID}', {
 page_path: '${pathname}${searchParams.toString()}',
 }); `,  }}  /> </>  )}   {/* Microsoft Clarity */}  {CLARITY_PROJECT_ID && (  <Script  id="microsoft-clarity"  strategy="afterInteractive"  dangerouslySetInnerHTML={{  __html: `  (function(c,l,a,r,i,t,y){ c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i; y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y); })(window, document, "clarity", "script", "${CLARITY_PROJECT_ID}");
 `,  }}  />  )}  </>  ); }
```

---

### **åã€æ•°æ®åˆ†ææœ€ä½³å®è·µ**

### **1. è®¾ç½®å…³é”®æŒ‡æ ‡**

1. å®šä¹‰ä½ çš„æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡ï¼ˆKPIï¼‰
2. åœ¨Google Analyticsä¸­è®¾ç½®ç›¸åº”çš„ç›®æ ‡å’Œè½¬åŒ–
3. å®šæœŸæ£€æŸ¥è¿™äº›æŒ‡æ ‡çš„å˜åŒ–

### **2. åˆ›å»ºè‡ªå®šä¹‰ä»ªè¡¨æ¿**

1. åœ¨Google Analyticsä¸­åˆ›å»ºè‡ªå®šä¹‰ä»ªè¡¨æ¿
2. åŒ…å«æœ€é‡è¦çš„æŒ‡æ ‡å’Œå›¾è¡¨
3. è®¾ç½®å®šæœŸé‚®ä»¶æŠ¥å‘Š

### **3. ç»“åˆä½¿ç”¨GAå’ŒClarity**

1. åœ¨Google Analyticsä¸­å‘ç°å¼‚å¸¸æ•°æ®
2. ä½¿ç”¨Clarityä¼šè¯å½•åˆ¶æŸ¥çœ‹å®é™…ç”¨æˆ·è¡Œä¸º
3. ä½¿ç”¨çƒ­å›¾åˆ†æé¡µé¢äº¤äº’çƒ­ç‚¹

### **4. A/Bæµ‹è¯•**

1. ä½¿ç”¨Google Optimizeï¼ˆä¸GAé›†æˆï¼‰è¿›è¡ŒA/Bæµ‹è¯•
2. æµ‹è¯•ä¸åŒè®¾è®¡ã€æ–‡æ¡ˆå’ŒåŠŸèƒ½
3. åŸºäºæ•°æ®ç»“æœä¼˜åŒ–ç½‘ç«™

---

### **åä¸€ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ**

âš ï¸ **åˆ†æä»£ç å½±å“ç½‘ç«™æ€§èƒ½**ï¼š

- ä½¿ç”¨`next/script`çš„`strategy="afterInteractive"`ç¡®ä¿ä¸é˜»å¡é¡µé¢åŠ è½½
- è€ƒè™‘ä½¿ç”¨è½»é‡çº§åˆ†ææ›¿ä»£æ–¹æ¡ˆï¼ˆå¦‚Plausibleæˆ–Simple Analyticsï¼‰

âš ï¸ **æ•°æ®ä¸å‡†ç¡®**ï¼š

- ç¡®ä¿æ’é™¤å†…éƒ¨IPåœ°å€
- æ£€æŸ¥æ˜¯å¦æœ‰å¹¿å‘Šæ‹¦æˆªå™¨å½±å“
- éªŒè¯è·Ÿè¸ªä»£ç æ˜¯å¦æ­£ç¡®å®‰è£…

âš ï¸ **éšç§åˆè§„é—®é¢˜**ï¼š

- å®æ–½CookieåŒæ„æœºåˆ¶
- åŒ¿ååŒ–IPåœ°å€
- éµå®ˆå½“åœ°æ•°æ®ä¿æŠ¤æ³•è§„

---

### **åäºŒã€ç»ƒä¹ ä»»åŠ¡**

1. åŸºç¡€ä»»åŠ¡ï¼š
    - åœ¨Next.jsé¡¹ç›®ä¸­é›†æˆGoogle Analytics
    - éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®æ”¶é›†
2. è¿›é˜¶ä»»åŠ¡ï¼š
    - æ·»åŠ Microsoft Clarityå¹¶æŸ¥çœ‹çƒ­å›¾æ•°æ®
    - è®¾ç½®è‡ªå®šä¹‰äº‹ä»¶è·Ÿè¸ª
3. æŒ‘æˆ˜ä»»åŠ¡ï¼š
    - å®ç°å®Œæ•´çš„CookieåŒæ„æœºåˆ¶
    - åˆ›å»ºè‡ªå®šä¹‰åˆ†æä»ªè¡¨æ¿

---

é€šè¿‡æœ¬æ•™ç¨‹ï¼Œä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•åœ¨Next.jsé¡¹ç›®ä¸­é›†æˆGoogle Analyticså’ŒMicrosoft Clarityï¼Œä»¥åŠå¦‚ä½•éµå®ˆéšç§æ³•è§„ã€‚è¿™äº›å·¥å…·å°†å¸®åŠ©ä½ æ›´å¥½åœ°äº†è§£ç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–ç½‘ç«™ä½“éªŒï¼Œå¹¶åšå‡ºæ•°æ®é©±åŠ¨çš„å†³ç­–ã€‚ğŸ“Š